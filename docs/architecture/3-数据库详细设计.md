# **3. 数据库详细设计**

  * **`companies` (公司主表)**: 存储每个公司的唯一、静态的身份信息。

    | 字段名 | 数据类型 | 约束/索引 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `company_code` | `VARCHAR(10)` | **PRIMARY KEY**, NOT NULL | 公司股票代码，作为唯一主键。 |
    | `company_name_full` | `VARCHAR(255)` | UNIQUE, NOT NULL | 公司完整的官方名称。 |
    | `company_name_short`| `VARCHAR(100)` | INDEX | 公司简称，建立索引以加速查询。 |
    | `exchange` | `VARCHAR(50)` | | 上市交易所。 |
    | `created_at` | `TIMESTAMPTZ` | DEFAULT NOW() | 记录创建时间。 |
    | `updated_at` | `TIMESTAMPTZ` | DEFAULT NOW() | 记录最后更新时间。 |

  * **`source_documents` (原始文档提取归档表)**: 永久、不可变地归档每一次的完整JSON提取结果。

    | 字段名 | 数据类型 | 约束/索引 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `doc_id` | `UUID` | **PRIMARY KEY** | 文档提取记录的唯一ID。 |
    | `company_code` | `VARCHAR(10)` | **FOREIGN KEY** -\> companies.company\_code | 关联到`companies`表。 |
    | `doc_type` | `VARCHAR(50)` | | 文档类型 ("annual\_report", "research\_report")。 |
    | `doc_date` | `DATE` | | 文档的发布日期。 |
    | `report_title` | `TEXT` | | 研报或年报的标题。 |
    | `raw_llm_output` | `JSONB` | NOT NULL | 存储从LLM返回的完整JSON。 |
    | `created_at` | `TIMESTAMPTZ` | DEFAULT NOW() | 记录归档时间。 |

  * **`business_concepts_master` (业务概念主数据表)**: 存储经过融合更新的、每个公司当前最权威的业务概念画像。

    | 字段名 | 数据类型 | 约束/索引 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `concept_id` | `UUID` | **PRIMARY KEY** | 业务概念的唯一ID。 |
    | `company_code` | `VARCHAR(10)` | **FOREIGN KEY** -\> companies.company\_code, INDEX | 关联到`companies`表。 |
    | `concept_name` | `VARCHAR(255)` | NOT NULL, INDEX | 业务概念的通用名称。 |
    | `embedding` | `VECTOR(1024)` | **HNSW INDEX**, NOT NULL | 存储由Qwen Embedding模型生成的向量。 |
    | `concept_details` | `JSONB` | | 存储该概念的所有其他详细信息 (`description`, `category`, `metrics`等)。 |
    | `last_updated_from_doc_id` | `UUID` | FOREIGN KEY -\> source\_documents.doc\_id | 指向`source_documents`表，用于追溯最新信息来源。 |
    | `updated_at` | `TIMESTAMPTZ` | DEFAULT NOW() | 记录该概念的最后更新时间。 |

-----
