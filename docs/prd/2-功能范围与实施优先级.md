# **2. 功能范围与实施优先级**

**高优先级 (Phase 1 - 技术验证与环境搭建)**

* **Story 1.1 : 关键技术与版本兼容性验证**
    * **描述**: 作为开发者，我需要搭建一个最小化原型，以验证最新的`langchain-postgres`包能够与我们的PostgreSQL + pgvector环境正常协作，并确认所有核心依赖（特别是Pydantic 2）在Python 3.9+环境下兼容。

* **Story 1.2 : 环境与数据库初始化**
    * **描述**: 作为开发者，我需要搭建起项目的基本结构，并初始化支持`pgvector`插件的PostgreSQL数据库，包括我们设计的`Companies`, `SourceDocuments`, 和 `BusinessConceptsMaster`三张核心表。
    * **技术细节**: 必须使用`psycopg3`及其`postgresql+psycopg://`格式的连接字符串进行连接。数据库索引策略应采用**HNSW**以获得更优性能。

**中优先级 (Phase 2 - 核心数据流实现)**

* **Story 2.1 : LLM数据提取脚本实现 (已修正)**
    * **描述**: 作为开发者，我需要创建一个基于LangChain的脚本，该脚本能够读取财报文件，使用最终版提示词调用LLM API，并利用最新的**`langchain_core.output_parsers.pydantic.PydanticOutputParser`和Pydantic 2的数据模型**，支持更严格的类型检查和自动验证，将返回的文本解析为Python数据对象。

* **Story 2.2 : 原始数据归档**
    * **描述**: 作为系统，我需要在从LLM获取到提取结果后，自动将这份完整的、未经修改的JSON连同其报告元信息，作为一个独立的记录存入`SourceDocuments`表中。

* **Story 2.3 : 主数据融合与更新**
    * **描述**: 作为系统，我需要在归档原始JSON后，自动执行“融合更新”算法，智能地将新提取出的业务概念信息更新到`BusinessConceptsMaster`主数据表中。

* **Story 2.4 : 向量索引构建 (已修正)**
    * **描述**: 作为系统，我需要对`BusinessConceptsMaster`表中的业务概念进行向量化处理，通过调用**本地部署的Qwen Embedding模型**生成向量，并利用**`langchain_postgres.PGVector`**进行向量存储，配合**psycopg3**连接PostgreSQL，利用**HNSW索引**优化查询性能。

* **Story 2.5 : 基础API接口与检索逻辑**
    * **描述**: 作为开发者，我需要搭建起核心API接口，并实现其后端逻辑：根据传入`query_identifier`，从主数据库找到业务概念，并利用`VectorStoreRetriever`完成初步的向量检索。

**低优先级 (Phase 3 - 优化与高级功能)**

* **Story 3.1 : Rerank模型集成与优化**
    * **描述**: 作为系统，在从向量检索器获取初步候选文档后，我需要使用本地部署的Qwen Rerank模型对这些文档进行重排序。
    * **硬件考量**: 需考虑双4090 GPU的资源分配，一块专用于Embedding，另一块用于Reranker。

* **Story 3.2 : 核心排序算法与结果返回**
    * **描述**: 作为系统，我需要对经过Rerank模型优化后的结果，应用核心排序算法，结合行情过滤器，最终返回结构化的、排序后的相关公司列表。
