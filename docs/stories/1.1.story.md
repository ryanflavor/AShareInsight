# Story 1.1: 关键技术与版本兼容性验证

## Status
Draft

## Story
**As a** developer,
**I want** to build a minimal prototype to verify that the latest `langchain-postgres` package can work correctly with our PostgreSQL + pgvector environment and confirm all core dependencies (especially Pydantic 2) are compatible in Python 3.9+ environment,
**so that** we establish a solid technical foundation for the enterprise concept retrieval system.

## Acceptance Criteria
1. Successfully create a minimal prototype environment with PostgreSQL + pgvector
2. Verify langchain-postgres package compatibility with our database setup
3. Confirm Pydantic 2.0+ compatibility with Python 3.13
4. Validate psycopg3 database connection with postgresql+psycopg:// format
5. Test basic vector operations using HNSW indexing strategy

## Tasks / Subtasks
- [ ] Set up Python 3.13 virtual environment using uv (AC: 3)
  - [ ] Install uv dependency manager
  - [ ] Create virtual environment with Python 3.13
  - [ ] Initialize pyproject.toml with basic project configuration
- [ ] Install and verify core dependencies (AC: 2, 3)
  - [ ] Install langchain-postgres >=0.0.12
  - [ ] Install psycopg >=3.1.0 (binary)
  - [ ] Install Pydantic >=2.0.0
  - [ ] Install pgvector >=0.2.4
  - [ ] Verify all packages install without conflicts
- [ ] Setup PostgreSQL with pgvector extension (AC: 1, 5)
  - [ ] Configure PostgreSQL database instance
  - [ ] Install and enable pgvector extension
  - [ ] Test HNSW index creation capabilities
- [ ] Create minimal database connection prototype (AC: 4)
  - [ ] Implement psycopg3 connection using postgresql+psycopg:// format
  - [ ] Test basic database connectivity
  - [ ] Verify connection pooling functionality
- [ ] Implement basic vector storage test (AC: 2, 5)
  - [ ] Create test table with vector column
  - [ ] Test langchain-postgres PGVector integration
  - [ ] Verify HNSW index performance with sample data
- [ ] Create compatibility validation script (AC: 1-5)
  - [ ] Script to verify all component integrations
  - [ ] Document any compatibility issues found
  - [ ] Generate compatibility report

## Dev Notes

### Previous Story Insights
No previous story exists - this is the first implementation story.

### Technical Stack Requirements
[Source: architecture/2-技术栈-tech-stack.md]
- **Python Version**: 3.13 (confirmed final version)
- **Core Dependencies**:
  - langchain-postgres >=0.0.12
  - psycopg >=3.1.0 (binary)
  - pgvector >=0.2.4  
  - Pydantic >=2.0.0
- **Dependency Management**: uv (by Astral) - latest stable version
- **Database Strategy**: PostgreSQL with pgvector extension using HNSW indexing

### Project Structure Requirements
[Source: architecture/4-源代码目录结构-source-tree.md]
- Root directory: `/enterprise-concept-retriever/`
- Virtual environment: `.venv/` (managed by uv)
- Core configuration: `pyproject.toml` (uv managed project configuration)
- Package structure: `packages/core/src/core/models.py` for Pydantic 2.0 data models

### Database Schema Context
[Source: architecture/3-数据库详细设计.md]
- **Vector Storage**: `business_concepts_master` table with `embedding` field as `VECTOR(1024)` with HNSW INDEX
- **Connection Format**: Must use `postgresql+psycopg://` connection string format
- **Indexing Strategy**: HNSW indexes for optimal vector search performance

### Coding Standards
[Source: architecture/9-编码标准与规范.md]
- **Type Hints**: Mandatory for all code
- **Data Models**: Must use Pydantic 2.0 (`from pydantic import BaseModel`)
- **Code Formatting**: Black and Ruff for formatting and linting
- **Naming**: Strict PEP 8 compliance

### Testing Requirements
[Source: architecture/8-测试策略-testing-strategy.md]
- **Test Framework**: pytest and pytest-mock
- **Test Structure**: Unit tests in `tests/` directory
- **Database Testing**: Use Docker-based PostgreSQL for integration tests
- **Mocking**: Mock all external dependencies in unit tests

### File Locations
Based on source tree structure:
- Main prototype script: `packages/core/src/core/`
- Database models: `packages/core/src/core/models.py`
- Test files: `tests/core/`
- Project configuration: `pyproject.toml` (root level)

### Technical Constraints
- Must validate PostgreSQL connection using psycopg3 with binary installation
- Vector operations must use HNSW indexing for performance optimization
- All database connections must use postgresql+psycopg:// format
- Pydantic models must be compatible with Pydantic 2.0+ API changes

## Testing
[Source: architecture/8-测试策略-testing-strategy.md]
- **Test Location**: `tests/` directory in project root
- **Test Framework**: pytest with pytest-mock for mocking external dependencies
- **Unit Tests**: Test each component in isolation with mocked dependencies
- **Integration Tests**: Use Docker-based PostgreSQL for database connectivity tests
- **Test Requirements**: 
  - Validate version compatibility of all packages
  - Test database connection and basic vector operations
  - Verify HNSW index creation and performance
  - Mock external dependencies during unit testing

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-18 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here*